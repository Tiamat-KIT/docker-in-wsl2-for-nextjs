import { FileTree } from 'nextra/components'
import {Callout} from "nextra/components"

# [Next.jsã‹ã‚‰Androidãƒã‚¤ãƒ†ã‚£ãƒ–ã‚¢ãƒ—ãƒªã‚’ãƒ“ãƒ«ãƒ‰ã™ã‚‹](https://hackmd.io/@lucasfernog/BkHI4e18j)

## ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ
```
/home/[ãƒ¦ãƒ¼ã‚¶å]/<ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª>
```

ã“ã®ã¨ãã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚‹ã€‚

<FileTree>
  <FileTree.Folder name="ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª" defaultOpen>
    <FileTree.File name="Dockerfile" />
    <FileTree.File name="docker-compose.yml" />
    <FileTree.Folder name="src">
      <FileTree.File name="Next.jsãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ" />
    </FileTree.Folder>
  </FileTree.Folder>
</FileTree>

## æ‰‹é †
### ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ•ã‚©ãƒ«ãƒ€ã®ä½œæˆ
```bash copy
mkdir <ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ•ã‚©ãƒ«ãƒ€å>
```
### ã‚³ãƒ¼ãƒ‰æ ¼ç´ç”¨ãƒ•ã‚©ãƒ«ãƒ€
```bash copy
cd <ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ•ã‚©ãƒ«ãƒ€å>
mkdir src
```

### Dockerfileã®ä½œæˆ
ã¾ãšã€ä»¥å‰Next.jsã«ã‚ˆã‚‹Webã‚¢ãƒ—ãƒªé–‹ç™ºã‚’è¡Œã†ãŸã‚ã®Dockerç’°å¢ƒã‚’æ§‹ç¯‰ã™ã‚‹éš›ã«<br/>
åˆ©ç”¨ã™ã‚‹Dockerãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ã‚’å†æ²
```Dockerfile
FROM node:18-alpine
WORKDIR /usr/app
```
ã“ã‚Œã¯ã€
- Node.jsã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³18ãŒæ—¢ã«å…¥ã£ã¦ã„ã‚‹ç’°å¢ƒã‚’åˆ©ç”¨
- ä½œæ¥­ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’`/usr/app`ã«ã™ã‚‹ã“ã¨ã‚’ç¤ºã—ã¦ã„ã‚‹
ï¼ˆ[Node.js ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’Dockerã‚³ãƒ³ãƒ†ãƒŠã«å–ã‚Šè¾¼ã‚€æ–¹æ³•](https://nodejs.org/ja/docs/guides/nodejs-docker-webapp)ã‹ã‚‰ä¸€éƒ¨å‚ç…§ï¼‰

Qiitaè¨˜äº‹[Docker ã§ Tauri ã®ç’°å¢ƒæ§‹ç¯‰ã™ã‚‹](https://qiita.com/Ritz/items/ecb4bc2d55a0d6967e6e)<br />
ã‚’å‚ç…§ã™ã‚‹ã€‚ã“ã®è¨˜äº‹ã«ãŠã‘ã‚‹Dockerfileã®è¨˜è¿°ã¯ä»¥ä¸‹ã§ã‚ã‚‹ã€‚
```Dockerfile
FROM rust:latest

RUN apt update -y
RUN apt install -y curl
RUN apt install -y gcc
RUN curl -fsSL https://deb.nodesource.com/setup_16.x | bash -
RUN apt update
RUN apt install -y nodejs
RUN npm install -g n
RUN n lts
RUN n prune
RUN curl -sS https://dl.yarnpkg.com/debian/pubkey.gpg | apt-key add -
RUN echo "deb https://dl.yarnpkg.com/debian/ stable main" | tee /etc/apt/sources.list.d/yarn.list
RUN apt update
RUN apt install -y yarn

WORKDIR /var/www/ 
RUN cargo install tauri-cli
RUN apt install -y libdbus-1-dev
RUN pkg-config --libs --cflags dbus-1
RUN apt install -y software-properties-common
RUN apt update
RUN apt install -y libgtk-3-dev
RUN apt install -y build-essential
RUN apt install -y libssl-dev
RUN apt install -y libayatana-appindicator3-dev
RUN apt install -y librsvg2-dev
RUN apt install -y libwebkit2gtk-4.0-dev
# windows_host_ip ã‚’ ã‚³ãƒ³ãƒ†ãƒŠå†…ã§ Windows ã® ip ã«å¤‰æ›´
RUN export DISPLAY=windows_host_ip:0.0 
RUN apt install -y mesa-utils
RUN apt install -y libgl1-mesa-glx
RUN export MESA_GL_VERSION_OVERRIDE=4.5
```
ã„ã†ã¦é›£ã—ã„è©±ã§ã‚‚ãªã„ã€‚
- å‰æã¨ã—ã¦Rustã®æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒå…¥ã£ã¦ã„ã‚‹ç’°å¢ƒã‚’å¼•ãå‡ºã™ã€‚
- aptã§curlã¨gccã‚’å°å…¥ã€‚
- curlã§node.jsã‚’å°å…¥ã€‚
- yarnã‚’å…¥ã‚Œã‚‹ã€‚
- ä½œæ¥­ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§ã¯ã€tauriã®cliã‚’å…¥ã‚Œã‚‹
- Tauriã‚’å‹•ä½œã•ã›ã‚‹ä¸Šã§å¿…è¦ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®å°å…¥
ä¸Šè¨˜ã®6ã¤ã‚’è¡Œã£ã¦ã„ã‚‹ã€‚<br />
ã‚ã¨ã¯windowsã®hostipã‚’ã„ã˜ã£ãŸã‚Šã€OpenGLå‘¨ã‚Šã®ã‚‚ã®ã‚’å…¥ã‚Œã¦ã„ã‚‹ãŒä»Šå›ã¯é–¢ä¿‚ãªã„

ä»Šå›ã¯å€‹äººçš„ãªä½¿ã„ã‚„ã™ã•ã‚‚è€ƒãˆã€ä»¥ä¸‹ã®ã‚ˆã†ãªDockerã®æ§‹æˆã¨ã™ã‚‹ã€‚
- RustãŒæ—¢ã«å…¥ã£ã¦ã„ã‚‹ã‚‚ã®ã‚’ä½¿ã†
- Node.jsã¯æ‰‹å‹•ã§å°å…¥ã™ã‚‹
- Bunã‚’ä½¿ã†
- WORKDIRã¯`/usr/app`ã¨ã™ã‚‹
- tauri-cliã¯Bunã‹ã‚‰å°å…¥ã™ã‚‹ã“ã¨ã¨ã™ã‚‹ã€‚

ã“ã®å†…å®¹ã‹ã‚‰ã€ä»¥ä¸‹ã®ã‚µã‚¤ãƒˆã®æƒ…å ±ã‚’ã‚‚ã¨ã«ã€
- Qiitaè¨˜äº‹[Docker ã§ Tauri ã®ç’°å¢ƒæ§‹ç¯‰ã™ã‚‹](https://qiita.com/Ritz/items/ecb4bc2d55a0d6967e6e)
- Qiitaè¨˜äº‹[WSL2ã«Node.jsã¨Yarnã‚’å°å…¥ã™ã‚‹](https://zenn.dev/ryuu/articles/wsl2-addyarn)
- [Installation | Bun Docs](https://bun.sh/docs/installation)
- [Next.js | Tauri Apps](https://tauri.app/v1/guides/getting-started/setup/next-js)

ã“ã®å†…å®¹ã§Dockerfileã‚’è¨˜è¿°ã™ã‚‹
```Dockerfile copy
# ãƒ™ãƒ¼ã‚¹ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’æŒ‡å®š
FROM ubuntu:20.04

# ç’°å¢ƒå¤‰æ•°ã®è¨­å®šï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®è¨­å®šã‚’éå¯¾è©±çš„ã«ã™ã‚‹ãŸã‚ï¼‰
ENV DEBIAN_FRONTEND=noninteractive

# ã‚·ã‚¹ãƒ†ãƒ ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆ
RUN apt-get update && \
    apt-get install -y --no-install-recommends \
    ca-certificates

# ã‚·ã‚¹ãƒ†ãƒ ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã¨å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
RUN apt-get update && \
    apt-get install -y --no-install-recommends \
    ca-certificates \
    build-essential \
    curl \
    wget \
    file \
    unzip \
    libssl-dev \
    libgtk-3-dev \
    libayatana-appindicator3-dev \
    librsvg2-dev \
    libwebkit2gtk-4.0-dev \
    openjdk-11-jdk-headless \
    && rm -rf /var/lib/apt/lists/*

# Android SDKã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
RUN mkdir -p /opt/android-sdk && \
    curl -o /tmp/sdk-tools.zip https://dl.google.com/android/repository/commandlinetools-linux-8512546_latest.zip && \
    unzip /tmp/sdk-tools.zip -d /opt/android-sdk && \
    rm /tmp/sdk-tools.zip

# Android NDKã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
RUN mkdir -p /opt/android-ndk && \
    curl -o /tmp/ndk.zip https://dl.google.com/android/repository/android-ndk-r26-linux.zip?hl=ja && \
    unzip /tmp/ndk.zip -d /opt/android-ndk && \
    rm /tmp/ndk.zip

# Rustã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
RUN curl --proto '=https' --tlsv1.2 https://sh.rustup.rs -sSf | sh -s -- -y

# Bunã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¨.bashrcã®èª­ã¿è¾¼ã¿
RUN curl https://bun.sh/install | bash && \
    echo "source ~/.bashrc" >> ~/.bashrc

# ç’°å¢ƒå¤‰æ•°ã®è¨­å®š
ENV JAVA_HOME=/usr/lib/jvm/java-11-openjdk-amd64
ENV ANDROID_HOME=/opt/android-sdk
ENV NDK_HOME=/opt/android-ndk/android-ndk-r23
ENV RUSTUP_HOME=/root/.rustup
ENV CARGO_HOME=/root/.cargo
ENV PATH=$PATH:$JAVA_HOME/bin:$RUSTUP_HOME/bin:$CARGO_HOME/bin:$ANDROID_HOME/cmdline-tools/latest/bin:$NDK_HOME

# ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’è¨­å®š
USER root

# ã‚³ãƒ³ãƒ†ãƒŠã‚’èµ·å‹•ã—ãŸã¨ãã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’è¨­å®š
WORKDIR /usr/app

# ã‚³ãƒ³ãƒ†ãƒŠãŒå®Ÿè¡Œã•ã‚Œã‚‹ã¨ãã«å®Ÿè¡Œã•ã‚Œã‚‹ã‚³ãƒãƒ³ãƒ‰ã‚’æŒ‡å®š
CMD ["bash"]
```

Dockerå´ã«å‹æ‰‹ã«ã‚„ã‚‰ã›ã‚‹ã®ã¯ã“ã“ã¾ã§
```bash
bun create next-app .
bun add -d @tauri-apps/cli@next @tauri-apps/api@next
bun tauri init
bun tauri dev
```
ãªã©ã¯å¾Œã‹ã‚‰å®Ÿè¡Œã™ã‚‹ã€‚

### docker-compose.ymlã®ä½œæˆ
å‰å›ä½œæˆã—ãŸã€docker-compose.ymlã¨<br />
Qiitaè¨˜äº‹[Docker ã§ Tauri ã®ç’°å¢ƒæ§‹ç¯‰ã™ã‚‹](https://qiita.com/Ritz/items/ecb4bc2d55a0d6967e6e)<br />
ã®ãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ã‹ã‚‰è€ƒãˆã¦ã€

```yaml copy
version: '3'

services:
  app:
    container_name: "tauri-app"
    build: ./
    tty: true
    volumes:
      - ./src:/usr/app
    
    ports:
      - "3000:3000"
```
ã¨ã™ã‚‹ã®ãŒã„ã„æ„Ÿã˜ã ã‚ã†ã€‚

### Dockerã‚³ãƒ³ãƒ†ãƒŠã‚’èµ·å‹•ã™ã‚‹
ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ•ã‚©ãƒ«ãƒ€ç›´ä¸‹ã§ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œ
```bash copy
docker-compose up -d
```

ã“ã†ã™ã‚‹ã¨ã€`http://localhost:3000`ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹
`src`é…ä¸‹ã§Next.jsã‚³ãƒ¼ãƒ‰ã‚’ä½œæˆã—ã¦å‹•ã‹ã—ã¦ã¿ã‚‹ã€‚

```bash
cd src/
bun create next-app .
bun add -d @tauri-apps/cli@next @tauri-apps/api@next
bun tauri init
cd src-tauri/
cargo add tauri@2.0.0-alpha.0
cargo add tauri-build@2.0.0-alpha.0 --build
cargo install tauri-cli --version "^2.0.0-alpha"
cargo build
cd ..
bun tauri dev
```

```js filename="next.config.js" copy
/** @type {import('next').NextConfig} */
const nextConfig = {
  reactStrictMode: true,
  swcMinify: true,
  // https://tauri.app/v1/guides/getting-started/setup/next-js/
  images: {
    unoptimized: true,
  },
}

module.exports = nextConfig
```

```json filename="package.json" copy
"scripts": {
  "dev": "next dev",
  "build": "next build",
  "start": "next start",
  "lint": "next lint",
  "export": "next export",
  "tauri": "tauri"
},
```

```json filename="src-tauri/tauri.conf.json" copy
{
  "tauri": {
    "bundle": {
      "identifier": "com.example.tauri-mobile-nextjs",
```
<Callout type="info" emoji="ï¸ğŸ˜Š">
  å‹•ä½œç¢ºèªã—ã¾ã—ãŸ
</Callout>
